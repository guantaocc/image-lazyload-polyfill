/*!
 * Vue-Lazyload.js v1.0.0
 * (c) 2023 guantao
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).VueLazyload={})}(this,(function(e){"use strict";class t{constructor(e=100){this.max=e||200,this.caches=[]}has(e){return-1!==this.caches.indexOf(e)}add(e){this.has(e)||(this.caches.push(e),this.caches.length>this.max&&this.free())}free(){this.caches.shift()}empty(){this.caches=[]}}class s{constructor(e,s){this.state={},this.initState(),this.el=e,this.src=s,this._imageCache=new t(200)}initState(){this.state={error:!1,loading:!0,loaded:!1}}render(){}load(){this.state.loaded||(this._imageCache.has(this.src)?this.state.loaded=!0:((e,t,s)=>{let i=new Image;if(!e||!e.src){const e=new Error("image src is required");return s(e)}i.src=e.src,e.cors&&(i.crossOrigin=e.cors),i.onload=function(){t({naturalHeight:i.naturalHeight,naturalWidth:i.naturalWidth,src:i.src})},i.onerror=function(e){s(e)}})({src:this.src},(e=>{this.naturalHeight=e.naturalHeight,this.naturalWidth=e.naturalWidth,this.state.loaded=!0,this.state.error=!1,this.state.rendered=!0,this._imageCache.add(this.src),this.el.src=this.src}),(e=>{!this.options.silent&&console.error(e),this.state.error=!0,this.state.loaded=!1,this.render("error",!1)})))}}function i(e){return class{constructor(e){this.options=e||{},this.version='"1.0.0"',this.listenerQueue=[],this.initEvents(),this.initIntersetionObserser(),this.lazyLoadHandler=function(e,t,s){var i,n=s||{},r=n.noTrailing,o=void 0!==r&&r,a=n.noLeading,h=void 0!==a&&a,l=n.debounceMode,d=void 0===l?void 0:l,c=!1,u=0;function f(){i&&clearTimeout(i)}function v(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];var a=this,l=Date.now()-u;function v(){u=Date.now(),t.apply(a,n)}function p(){i=void 0}c||(h||!d||i||v(),f(),void 0===d&&l>e?h?(u=Date.now(),o||(i=setTimeout(d?p:v,e))):v():!0!==o&&(i=setTimeout(d?p:v,void 0===d?e-l:e)))}return v.cancel=function(e){var t=(e||{}).upcomingOnly,s=void 0!==t&&t;f(),c=!s},v}(this._lazyLoadHandler.bind(this),this.options.throttleWait||200)}_lazyLoadHandler(){}initIntersetionObserser(){this._observer=new IntersectionObserver(this._observerHandler.bind(this),{rootMargin:"0px",threshold:0}),this.listenerQueue.length&&this.listenerQueue.forEach((e=>{this._oberver.observe(e.el)}))}_observerHandler(e,t){e.forEach((e=>{e.isIntersecting&&this.listenerQueue.forEach((t=>{if(t.el===e.target){if(console.log("entried"),t.state.loaded)return this._observer.unobserve(t.el);t.load()}}))}))}initEvents(){this.Event={listeners:[]},this.$on=(e,t)=>{this.Event.listeners[e]||(this.Event.listeners[e]=[]),this.Event.listeners[e].push(t)},this.$off=(e,t)=>{if(!func){if(!this.Event.listeners[e])return;return void(this.Event.listeners[e].length=0)}const s=this.Event.listeners[e].indexOf(t);-1!==s&&this.Event.listeners.splice(s,1)},this.$emit=(e,t)=>{this.Event.listeners[e]&&this.Event.listeners[e].forEach((e=>{e.apply(null,t)}))},this.$once=(e,t)=>{const s=this;this.$on(e,(function(){s.$off(e,t),t.apply(s,arguments)}))}}add(t,i,n){e.nextTick((()=>{console.log("add element");let e=i.value;this._observer&&this._observer.observe(t);const n=new s(t,e);this.listenerQueue.push(n)}))}update(e){}remove(e){}}}var n={install(e,t){if("2"===e.version.split(".")[0]){const s=new(i(e))(t);e.directive("lazy",{bind:s.add.bind(s),update:s.update.bind(s),unbind:s.remove.bind(s)})}}};e.default=n,Object.defineProperty(e,"__esModule",{value:!0})}));
